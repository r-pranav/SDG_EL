<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Air Quality Monitor</title>
  <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@400;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0; padding: 0;
      box-sizing: border-box;
      font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    body {
      background: #f8f9fa;
      color: #111;
      padding: 2rem;
    }
    .container {
      max-width: 700px;
      margin: auto;
      background: #ffffff;
      border-radius: 18px;
      box-shadow: 0 15px 25px rgba(0,0,0,0.07);
      padding: 30px;
    }
    h1 {
      text-align: center;
      font-weight: 600;
      font-size: 2rem;
      margin-bottom: 2rem;
      color: #000;
    }
    .data-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 20px;
      margin-bottom: 2rem;
    }
    .data-card {
      background: #f2f2f7;
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      transition: 0.2s ease;
    }
    .data-card:hover {
      background: #e5e5ea;
    }
    .label {
      font-size: 0.85rem;
      color: #888;
    }
    .value {
      font-size: 1.5rem;
      font-weight: 600;
      margin-top: 6px;
    }
    .aqi-box {
      text-align: center;
      padding: 15px;
      font-size: 1.3rem;
      border-radius: 10px;
      font-weight: bold;
      margin-top: 20px;
    }
    .aqi-good { background: #d4f4dd; color: #2c7a45; }
    .aqi-moderate { background: #fff6d1; color: #b48200; }
    .aqi-unhealthy { background: #ffd2cc; color: #8e201c; }
    .aqi-very-unhealthy { background: #ffbbbb; color: #6b0000; }

    @media (max-width: 500px) {
      .data-card { padding: 15px; }
      .value { font-size: 1.2rem; }
    }

    footer {
      text-align: center;
      margin-top: 40px;
      font-size: 0.8rem;
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Air Quality Dashboard</h1>

    <div class="data-section" id="gases">
      <!-- Filled dynamically -->
    </div>

    <div class="data-section" id="composition">
      <!-- Filled dynamically -->
    </div>

    <div id="aqiBox" class="aqi-box">Loading AQI...</div>
  </div>

  <footer>Live data powered by Firebase & NodeMCU</footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyC634Ru39oQtt5IfewhKb8hpt7X0SieTUs",
      authDomain: "sdg-project-311ec.firebaseapp.com",
      databaseURL: "https://sdg-project-311ec-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "sdg-project-311ec",
      storageBucket: "sdg-project-311ec.appspot.com",
      messagingSenderId: "831077716",
      appId: "1:831077716:web:fd9dc93f10b7d84cce9cc1",
      measurementId: "G-VQMNNGGMX0"
    };

    firebase.initializeApp(firebaseConfig);
    const dbRef = firebase.database().ref("/sensorData");

    dbRef.on("value", snapshot => {
      const data = snapshot.val();
      if (!data) return;
      const latest = Object.values(data).pop();

      const gases = {
        "CO₂ (ppm)": latest.ppm_CO2,
        "NH₃ (ppm)": latest.ppm_NH3,
        "NOₓ (ppm)": latest.ppm_NOx,
        "CO (ppm)": latest.ppm_CO,
        "VOC (ppm)": latest.ppm_VOC,
        "Alcohol (ppm)": latest.ppm_Alcohol
      };

      const air = {
        "Oxygen (%)": latest.percentO2,
        "Nitrogen (%)": latest.percentN2,
        "CO₂ (%)": latest.percentCO2,
        "Other Gases (%)": latest.percentOthers
      };

      document.getElementById("gases").innerHTML = renderCards(gases);
      document.getElementById("composition").innerHTML = renderCards(air);

      // AQI Box
      const aqiBox = document.getElementById("aqiBox");
      const aqi = (latest.AQI || "").toLowerCase();
      aqiBox.textContent = "AQI: " + (latest.AQI || "N/A");
      aqiBox.className = "aqi-box";
      if (aqi === "good") aqiBox.classList.add("aqi-good");
      else if (aqi === "moderate") aqiBox.classList.add("aqi-moderate");
      else if (aqi === "unhealthy") aqiBox.classList.add("aqi-unhealthy");
      else if (aqi === "very unhealthy") aqiBox.classList.add("aqi-very-unhealthy");
    });

    function renderCards(obj) {
      return Object.entries(obj).map(([label, val]) => `
        <div class="data-card">
          <div class="label">${label}</div>
          <div class="value">${val ?? "N/A"}</div>
        </div>
      `).join("");
    }
  </script>
</body>
</html>
